#!/bin/bash

# Path to the config file
CONFIG_FILE="config.conf"

# Function to check if a key exists in the config file
key_exists_in_config() {
    grep -q "^$1=" "$CONFIG_FILE"
    return $?
}

# Function to add or update a key in the config file
set_config_key() {
    if key_exists_in_config "$1"; then
        sed -i "s|^$1=.*|$1=$2|" "$CONFIG_FILE"
    else
        echo "$1=$2" >> "$CONFIG_FILE"
    fi
}

# Function to clone SpyHunt if not already present
clone_spyhunt() {
    if [ ! -d "tools/spyhunt" ]; then
        echo "Cloning SpyHunt into tools directory..."
        git clone https://github.com/gotr00t0day/spyhunt.git tools/spyhunt
    else
        echo "SpyHunt already exists in the tools directory."
    fi
}

# Check if spyhunt_path is defined in config.conf
if key_exists_in_config "spyhunt_path"; then
    echo "spyhunt_path is already defined in $CONFIG_FILE."
else
    echo "spyhunt_path is not defined in $CONFIG_FILE."

    # Check if tools directory exists
    if [ ! -d "tools" ]; then
        echo "Creating tools directory..."
        mkdir tools
    fi

    # Clone SpyHunt into tools directory and set the path in config.conf
    clone_spyhunt

    # Set the spyhunt_path in the config file
    SPYHUNT_PATH="$(pwd)/tools/spyhunt"
    set_config_key "spyhunt_path" "$SPYHUNT_PATH"
    echo "spyhunt_path set to $SPYHUNT_PATH in $CONFIG_FILE."
fi
